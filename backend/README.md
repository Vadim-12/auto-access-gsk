# Auto Access GSK - Backend

Система автоматического контроля доступа к гаражам с использованием компьютерного зрения.

## Технологии

- NestJS
- TypeScript
- TypeORM
- PostgreSQL
- OpenAI GPT-4 Vision API

## Основные модули

### 1. Модуль камеры (`CameraModule`)

- Отслеживание камер в гаражах
- Периодический сбор изображений
- Интеграция с GPT-4 Vision для анализа

### 2. Модуль AI (`AiModule`)

- Анализ изображений с помощью GPT-4 Vision
- Определение номеров и цветов автомобилей
- Принятие решений о доступе

### 3. Модуль гаража (`GarageModule`)

- Управление гаражами
- Журнал доступа
- Управление пользователями гаража

### 4. Модуль автомобилей (`CarModule`)

- Управление автомобилями пользователей
- Привязка автомобилей к пользователям

## API Endpoints

### Гаражи

- `GET /api/garages` - список гаражей
- `POST /api/garages` - создание гаража
- `GET /api/garages/:id` - информация о гараже
- `GET /api/garages/:id/access-logs` - журнал доступа

### Камеры

- `POST /api/cameras` - добавление камеры
- `PUT /api/cameras/:id` - обновление настроек камеры

### Автомобили

- `GET /api/cars` - список автомобилей
- `POST /api/cars` - добавление автомобиля
- `PUT /api/cars/:id` - обновление информации об автомобиле

## Установка и запуск

1. Установка зависимостей:

```bash
yarn install
```

2. Настройка переменных окружения:

```bash
cp .env.example .env
```

Заполните необходимые переменные в `.env`

3. Запуск миграций:

```bash
yarn typeorm migration:run -d src/config/orm.datasource.local.ts
```

4. Запуск сервера:

```bash
yarn start:dev
```

## Логика работы системы

1. Камера делает снимок каждую минуту
2. Изображение отправляется в GPT-4 Vision
3. AI анализирует:
   - Номер автомобиля
   - Цвет автомобиля
   - Дополнительные параметры (марка, модель, год)
4. Система принимает решение о доступе:
   - Если номер совпадает с известным - доступ разрешен
   - Если номер не виден или не совпадает - доступ запрещен
5. Результат сохраняется в журнале доступа

## Безопасность

- JWT аутентификация
- Проверка прав доступа к гаражам
- Безопасное хранение API ключей
- Логирование всех действий

## Тестирование

```bash
# unit tests
yarn test

# e2e tests
yarn test:e2e

# test coverage
yarn test:cov
```

## Лицензия

MIT
